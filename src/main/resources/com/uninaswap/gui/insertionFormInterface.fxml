<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.TitledPane?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.RowConstraints?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.shape.Rectangle?>

<BorderPane maxHeight="-Infinity" maxWidth="-Infinity" prefHeight="800.0" prefWidth="1200.0" styleClass="insertion-container" stylesheets="@../guiCSS/newInsertion.css" xmlns="http://javafx.com/javafx/23.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.uninaswap.controllers.InsertionFormController">

    <top>
        <VBox spacing="0">
            <!-- Banner superiore compatto -->
            <HBox alignment="CENTER_RIGHT" maxHeight="35.0" styleClass="top-banner">
                <Label styleClass="welcome-text" text="Pubblica il tuo annuncio su UninaSwap" />
                <Region HBox.hgrow="ALWAYS" />
                <padding>
                    <Insets bottom="5.0" left="15.0" right="15.0" top="5.0" />
                </padding>
            </HBox>

            <!-- Header principale ottimizzato -->
            <HBox alignment="CENTER" minHeight="60.0" styleClass="main-header">
                <!-- Logo container -->
                <HBox alignment="CENTER_LEFT" minWidth="200.0" styleClass="logo-container">
                    <StackPane styleClass="logo-badge">
                        <Rectangle height="50.0" styleClass="logo-background" width="180.0" />
                        <ImageView fx:id="logoImage" fitHeight="40.0" preserveRatio="true" styleClass="logo-image">
                            <Image url="@../images/uninaswap_logo.png" />
                        </ImageView>
                    </StackPane>
                </HBox>

                <!-- Titolo centrale -->
                <HBox alignment="CENTER" styleClass="title-container" HBox.hgrow="ALWAYS">
                    <Label fx:id="headFunctionalityLabel" styleClass="header-title" text="Crea nuova inserzione" />
                </HBox>

                <!-- Pulsanti azione -->
                <HBox alignment="CENTER_RIGHT" spacing="15">
                    <Button fx:id="backButton" onAction="#goBack" styleClass="back-button" text="Indietro" />
                </HBox>
                <padding>
                    <Insets bottom="8.0" left="15.0" right="15.0" top="8.0" />
                </padding>
            </HBox>

            <!-- Barra di progresso -->
            <HBox alignment="CENTER" styleClass="progress-bar">
                <HBox alignment="CENTER" spacing="20" styleClass="progress-steps">
                    <Label styleClass="progress-step active" text="1. Dettagli" />
                    <Separator prefWidth="50" />
                    <Label styleClass="progress-step" text="2. Immagini" />
                    <Separator prefWidth="50" />
                    <Label styleClass="progress-step" text="3. Pubblicazione" />
                </HBox>
                <padding>
                    <Insets bottom="10.0" left="15.0" right="15.0" top="10.0" />
                </padding>
            </HBox>
        </VBox>
    </top>

    <center>
        <ScrollPane fitToWidth="true" styleClass="form-scroll-pane">
            <VBox spacing="25.0" styleClass="content-panel">
                <padding>
                    <Insets bottom="30.0" left="30.0" right="30.0" top="20.0" />
                </padding>
                <children>
                    <!-- Sezione Informazioni Base -->
                    <TitledPane expanded="true" styleClass="form-section" text="📝 Informazioni Base">
                        <VBox spacing="20">
                            <GridPane hgap="20" styleClass="form-grid" vgap="20">
                                <columnConstraints>
                                    <ColumnConstraints hgrow="NEVER" maxWidth="150.0" minWidth="120.0" />
                                    <ColumnConstraints hgrow="ALWAYS" minWidth="300.0" />
                                </columnConstraints>
                                <rowConstraints>
                                    <RowConstraints />
                                    <RowConstraints />
                                    <RowConstraints />
                                </rowConstraints>

                                <children>
                                    <!-- Titolo -->
                                    <Label styleClass="field-label" text="Titolo dell'annuncio:" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                                    <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                                        <TextField fx:id="titleField" promptText="Es: Libro di Analisi Matematica - Perfette condizioni" styleClass="main-text-field" />
                                        <Label styleClass="field-hint" text="Sii specifico e descrittivo per attirare più interesse" />
                                    </VBox>

                                    <!-- Categoria -->
                                    <Label styleClass="field-label" text="Categoria:" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                                    <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="1">
                                        <ComboBox fx:id="categoryComboBox" maxWidth="250.0" prefWidth="250.0" styleClass="combo-box" />
                                        <Label styleClass="field-hint" text="Seleziona la categoria più appropriata" />
                                    </VBox>

                                    <!-- Tipo -->
                                    <Label styleClass="field-label" text="Tipo di annuncio:" GridPane.columnIndex="0" GridPane.rowIndex="2" />
                                    <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="2">
                                        <ComboBox fx:id="typeComboBox" maxWidth="250.0" prefWidth="250.0" styleClass="combo-box" />
                                        <Label styleClass="field-hint" text="Vuoi vendere, prestare o scambiare?" />
                                    </VBox>
                                </children>
                            </GridPane>
                        </VBox>
                    </TitledPane>

                    <!-- Sezione Prezzo e Condizioni -->
                    <TitledPane expanded="true" styleClass="form-section" text="💰 Prezzo">
                        <GridPane hgap="20" styleClass="form-grid" vgap="20">
                            <columnConstraints>
                                <ColumnConstraints hgrow="NEVER" maxWidth="150.0" minWidth="120.0" />
                                <ColumnConstraints hgrow="ALWAYS" minWidth="300.0" />
                            </columnConstraints>
                            <rowConstraints>
                                <RowConstraints />
                                <RowConstraints />
                            </rowConstraints>

                            <children>
                                <!-- Prezzo -->
                                <Label fx:id="priceLabel" prefHeight="20.0" prefWidth="162.0" styleClass="field-label" text="Prezzo:" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                                <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                                    <HBox alignment="CENTER_LEFT" spacing="10">
                                        <TextField fx:id="priceField" maxWidth="150.0" promptText="0.00" styleClass="price-field" translateY="11.0" />
                                        <Label styleClass="currency-label" text="€" translateY="11.0" />
                                        <Region HBox.hgrow="ALWAYS" />
                                    </HBox>
                                    <Label styleClass="field-hint" text="Inserisci un prezzo competitivo per vendere più velocemente" translateY="12.0" />
                                </VBox>
                                <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="1" />
                            </children>
                        </GridPane>
                    </TitledPane>

                    <!-- Sezione Descrizione -->
                    <TitledPane fx:id="productDescription" expanded="true" styleClass="form-section" text="📄 Descrizione Dettagliata">
                        <VBox spacing="15">
                            <VBox spacing="5">
                                <TextArea fx:id="descriptionArea" onKeyTyped="#updateCharacterCount" prefHeight="150.0" promptText="Descrivi l'articolo in dettaglio: condizioni, anno di acquisto, motivo della vendita, eventuali difetti, contenuti inclusi..." styleClass="main-text-area" wrapText="true" />
                                <HBox alignment="CENTER_LEFT" spacing="10">
                                    <Label fx:id="characterCountLabel" onKeyTyped="#updateCharacterCount" styleClass="character-count" text="0/500 caratteri" />
                                    <Region HBox.hgrow="ALWAYS" />
                                    <Label styleClass="field-hint" text="Una descrizione dettagliata aumenta le possibilità di vendita" />
                                </HBox>
                            </VBox>

                            <!-- Suggerimenti per la descrizione -->
                            <VBox spacing="8" styleClass="tips-container">
                                <Label styleClass="tips-title" text="💡 Suggerimenti per una buona descrizione:" />
                                <Label styleClass="tip-item" text="• Specifica l'anno di acquisto e la casa editrice (per i libri)" />
                                <Label styleClass="tip-item" text="• Indica eventuali sottolineature, annotazioni o difetti" />
                                <Label styleClass="tip-item" text="• Menciona se sono inclusi materiali aggiuntivi (CD, codici, ecc.)" />
                                <Label styleClass="tip-item" text="• Spiega il motivo della vendita per dare fiducia" />
                            </VBox>
                        </VBox>
                    </TitledPane>

                    <!-- Sezione Immagini -->
                    <TitledPane expanded="true" styleClass="form-section" text="📸 Immagini dell'Articolo">
                        <VBox spacing="15">
                            <!-- Upload principale -->
                            <VBox spacing="10" styleClass="image-upload-main">
                                <Label styleClass="field-label" text="Immagine principale:" />
                                <HBox alignment="CENTER_LEFT" spacing="15">
                                    <VBox alignment="CENTER" styleClass="image-preview-container">
                                        <ImageView fx:id="mainImagePreview" fitHeight="100.0" fitWidth="100.0" preserveRatio="true" styleClass="image-preview" />
                                        <Label styleClass="image-preview-text" text="Anteprima" />
                                    </VBox>
                                    <VBox spacing="10" HBox.hgrow="ALWAYS">
                                        <HBox alignment="CENTER_LEFT" spacing="10">
                                            <TextField fx:id="imagePathField" editable="false" promptText="Nessuna immagine selezionata" styleClass="main-text-field" HBox.hgrow="ALWAYS" />
                                            <Button onAction="#handleSelectImage" styleClass="browse-button" text="Sfoglia..." />
                                        </HBox>
                                        <Label styleClass="field-hint" text="Carica una foto chiara e ben illuminata (max 5MB)" />
                                    </VBox>
                                </HBox>
                            </VBox>

                            <!-- Suggerimenti per le foto -->
                            <VBox spacing="8" styleClass="tips-container">
                                <Label styleClass="tips-title" text="📷 Consigli per foto efficaci:" />
                                <Label styleClass="tip-item" text="• Usa luce naturale per colori più realistici" />
                                <Label styleClass="tip-item" text="• Mostra eventuali difetti per trasparenza" />
                                <Label styleClass="tip-item" text="• Includi copertina e retro (per i libri)" />
                                <Label styleClass="tip-item" text="• Evita sfondi disordinati" />
                            </VBox>
                        </VBox>
                    </TitledPane>

                    <!-- Sezione Informazioni Aggiuntive -->
                    <TitledPane expanded="true" styleClass="form-section" text="📍 Informazioni aggiuntive">
                        <VBox spacing="15">
                            <GridPane hgap="20" styleClass="form-grid" vgap="15">
                                <columnConstraints>
                                    <ColumnConstraints hgrow="NEVER" maxWidth="150.0" minWidth="120.0" />
                                    <ColumnConstraints hgrow="ALWAYS" minWidth="300.0" />
                                </columnConstraints>
                                <rowConstraints>
                                    <RowConstraints />
                                    <RowConstraints />
                                </rowConstraints>

                                <children>
                                    <Label styleClass="field-label" text="Luogo di ritiro:" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                                    <ComboBox fx:id="locationComboBox" maxWidth="250.0" prefWidth="250.0" promptText="Seleziona la facoltà" styleClass="combo-box" GridPane.columnIndex="1" GridPane.rowIndex="0" />

                                    <!-- Sostituisci il TextArea deliveryArea con questo ComboBox -->
                                    <Label styleClass="field-label" text="Modalità consegna:" GridPane.columnIndex="0" GridPane.rowIndex="1" GridPane.valignment="TOP" />
                                    <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="1">
                                        <ComboBox fx:id="deliveryMethodComboBox" maxWidth="250.0" prefWidth="250.0" promptText="Seleziona modalità" styleClass="combo-box" />
                                        <Label styleClass="field-hint" text="Scegli come intendi consegnare l'articolo" />
                                    </VBox>
                                </children>
                            </GridPane>
                        </VBox>
                    </TitledPane>

                    <Separator styleClass="main-separator" />

                    <!-- Pulsanti finali -->
                    <HBox alignment="CENTER" spacing="20.0" styleClass="action-buttons">
                        <Region HBox.hgrow="ALWAYS" />
                        <Button fx:id="cancelButton" onAction="#handleCancel" styleClass="cancel-button" text="Annulla" />
                        <Button fx:id="publishInsertionButton" defaultButton="true" onAction="#handleSave" styleClass="publish-button" text="Pubblica Annuncio" />
                    </HBox>

                    <!-- Footer informativo -->
                    <VBox spacing="10" styleClass="footer-info">
                        <Separator />
                        <HBox alignment="CENTER" spacing="20">
                            <Label styleClass="footer-text" text="📋 Il tuo annuncio sarà visibile subito dopo la pubblicazione" />
                            <Separator orientation="VERTICAL" prefHeight="20" />
                            <Label styleClass="footer-text" text="✉️ Riceverai notifiche per messaggi e interesse" />
                            <Separator orientation="VERTICAL" prefHeight="20" />
                            <Label styleClass="footer-text" text="⭐ Profilo verificato = più fiducia" />
                        </HBox>
                    </VBox>
                </children>
            </VBox>
        </ScrollPane>
    </center>
</BorderPane>
